{"ast":null,"code":"var _jsxFileName = \"/home/colin/Downloads/react-tut/stock_react/react_app/src/ZoomableLineChart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useRef, useEffect, useState } from \"react\";\nimport { select, scaleLinear, line, max, curveCardinal, axisBottom, axisLeft, zoom, scaleTime } from \"d3\";\nimport useResizeObserver from \"./useResizeObserver\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nfunction max_price(prices) {\n  let max_price = -1;\n  prices.forEach(price => {\n    if (price.value > max_price) {\n      max_price = price.value;\n    }\n  });\n  return max_price;\n}\n\nfunction ZoomableLineChart({\n  data,\n  id = \"myZoomableLineChart\"\n}) {\n  _s();\n\n  const svgRef = useRef();\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n  const [currentZoomState, setCurrentZoomState] = useState(); //Tooltip\n\n  var div = d3.select(\"body\").append(\"div\").attr(\"class\", \"tooltip\").style(\"opacity\", 0); //fixing raw stock data\n\n  var prices = [];\n  data[0][\"values\"].forEach(v => {\n    prices.push({\n      datetime: Date.parse(v[\"datetime\"]),\n      value: Number(v[\"open\"])\n    });\n  });\n  prices = prices.reverse();\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const svgContent = svg.select(\".content\");\n    const {\n      width,\n      height\n    } = dimensions || wrapperRef.current.getBoundingClientRect(); // scales + line generator\n\n    const xScale = scaleTime().domain([prices.at(0).datetime, prices.at(-1).datetime]).range([0, width]);\n\n    if (currentZoomState) {\n      const newXScale = currentZoomState.rescaleX(xScale);\n      xScale.domain(newXScale.domain());\n    }\n\n    const yScale = scaleLinear().domain([0, max_price(prices)]).range([height, 0]); //Lines\n\n    svgContent.selectAll(\"path\").remove();\n    svgContent.append(\"path\").datum(prices).attr(\"fill\", \"none\").attr(\"stroke\", \"steelblue\").attr(\"stroke-width\", 1.5).attr(\"d\", line().x(function (d) {\n      return xScale(d.datetime);\n    }).y(function (d) {\n      return yScale(d.value);\n    })); //Hover info\n\n    svg.on(\"mousemove\", function (event) {\n      let bbox = svg.node().getBoundingClientRect();\n      let x = event.clientX - bbox.left;\n      let y = event.clientY - bbox.top;\n      let price = prices.find(e => e.datetime == xScale.invert(x));\n      let closest_date_dist = 1E8;\n      let closest_price = new Date();\n      let dist;\n      prices.forEach(e => {\n        dist = Math.abs(e.datetime - Number(xScale.invert(x)));\n\n        if (dist < closest_date_dist) {\n          closest_date_dist = dist;\n          closest_price = e;\n        }\n      });\n      if (closest_price === undefined) return;\n      svgContent.selectAll(\"circle\").remove();\n      svgContent.selectAll(\"line\").remove();\n      let date = new Date(closest_price.datetime);\n      svgContent.append(\"circle\").attr(\"r\", 4.5).attr(\"cx\", function (d) {\n        return xScale(date);\n      }).attr(\"cy\", function (d) {\n        return yScale(closest_price.value);\n      });\n      svgContent.append(\"line\").style(\"stroke\", \"steelblue\").style(\"stroke-dasharray\", \"3,3\").style(\"opacity\", 1).attr(\"x1\", function (d) {\n        return xScale(date);\n      }).attr(\"y1\", function (d) {\n        return yScale(yScale.domain()[0]);\n      }).attr(\"x2\", function (d) {\n        return xScale(date);\n      }).attr(\"y2\", function (d) {\n        return yScale(yScale.domain()[1]);\n      });\n      div.transition().duration(200).style(\"opacity\", .9);\n      div.html(date.toLocaleDateString() + \"<br/>$\" + closest_price.value).style(\"left\", xScale(date) + \"px\").style(\"top\", yScale(closest_price.value) + \"px\");\n    }); //svgContent.datum(prices).attr(\"d\", line().x(function(d) { console.log(d.datetime); return xScale(d.datetime) }));\n    //   svgContent.selectAll(\"path\")\n    // .on(\"mouseover\", function(d) {\n    //       div.transition()\n    //          .duration(200)\n    //          .style(\"opacity\", .9);\n    //       div.html(formatCount(d.total_km) + \" km\" + \"<br/>\" + formatTime(d.date))\n    //          .style(\"left\", (d3.event.pageX - 20) + \"px\")\n    // \t\t     .style(\"top\", (d3.event.pageY + 6) + \"px\");\n    //       //selects the horizontal dashed line in the group\n    //       d3.select(this.nextElementSibling).transition()\n    //           .duration(200)\n    //           .style(\"opacity\", .9);\n    //       //selects the vertical dashed line in the group\n    //       d3.select(this.nextElementSibling.nextElementSibling).transition()\n    //           .duration(200)\n    //           .style(\"opacity\", .9);\n    //       })\n    // axes\n\n    const xAxis = axisBottom(xScale);\n    svg.select(\".x-axis\").attr(\"transform\", `translate(0, ${height})`).call(xAxis);\n    const yAxis = axisLeft(yScale);\n    svg.select(\".y-axis\").call(yAxis); // zoom\n\n    const zoomBehavior = zoom().scaleExtent([1, 500]).translateExtent([[0, 0], [width, height]]).on(\"zoom\", event => {\n      const zoomState = event.transform;\n      setCurrentZoomState(zoomState);\n    });\n    svg.call(zoomBehavior);\n  }, [currentZoomState, data, dimensions]);\n  return /*#__PURE__*/_jsxDEV(React.Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(\"h1\", {\n      children: \" APPL \"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 5\n    }, this), \" \", /*#__PURE__*/_jsxDEV(\"div\", {\n      ref: wrapperRef,\n      style: {\n        marginBottom: \"2rem\"\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"svg\", {\n        ref: svgRef,\n        children: [/*#__PURE__*/_jsxDEV(\"defs\", {\n          children: [/*#__PURE__*/_jsxDEV(\"clipPath\", {\n            id: id,\n            children: /*#__PURE__*/_jsxDEV(\"rect\", {\n              x: \"0\",\n              y: \"0\",\n              width: \"100%\",\n              height: \"100%\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 5\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 225,\n            columnNumber: 5\n          }, this), \" \"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 5\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"g\", {\n          className: \"content\",\n          clipPath: `url(#${id})`,\n          children: \" \"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 236,\n          columnNumber: 12\n        }, this), \" \", /*#__PURE__*/_jsxDEV(\"g\", {\n          className: \"x-axis\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"g\", {\n          className: \"y-axis\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 242,\n          columnNumber: 5\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 219,\n        columnNumber: 5\n      }, this), \" \"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 22\n    }, this), \" \"]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 207,\n    columnNumber: 12\n  }, this);\n}\n\n_s(ZoomableLineChart, \"/KiWkGO4xuCDaFbcDOaAf23vnZg=\", false, function () {\n  return [useResizeObserver];\n});\n\n_c = ZoomableLineChart;\nexport default ZoomableLineChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"ZoomableLineChart\");","map":{"version":3,"sources":["/home/colin/Downloads/react-tut/stock_react/react_app/src/ZoomableLineChart.js"],"names":["React","useRef","useEffect","useState","select","scaleLinear","line","max","curveCardinal","axisBottom","axisLeft","zoom","scaleTime","useResizeObserver","max_price","prices","forEach","price","value","ZoomableLineChart","data","id","svgRef","wrapperRef","dimensions","currentZoomState","setCurrentZoomState","div","d3","append","attr","style","v","push","datetime","Date","parse","Number","reverse","svg","current","svgContent","width","height","getBoundingClientRect","xScale","domain","at","range","newXScale","rescaleX","yScale","selectAll","remove","datum","x","d","y","on","event","bbox","node","clientX","left","clientY","top","find","e","invert","closest_date_dist","closest_price","dist","Math","abs","undefined","date","transition","duration","html","toLocaleDateString","xAxis","call","yAxis","zoomBehavior","scaleExtent","translateExtent","zoomState","transform","marginBottom"],"mappings":"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","sourcesContent":["import React, {\n  useRef,\n  useEffect,\n  useState\n} from \"react\";\nimport {\n  select,\n  scaleLinear,\n  line,\n  max,\n  curveCardinal,\n  axisBottom,\n  axisLeft,\n  zoom,\n  scaleTime\n} from \"d3\";\nimport useResizeObserver from \"./useResizeObserver\";\n\nfunction max_price(prices) {\n  let max_price = -1;\n  prices.forEach((price) => {\n    if (price.value > max_price) {\n      max_price = price.value;\n    }\n  });\n  return max_price;\n}\n\nfunction ZoomableLineChart({\n  data,\n  id = \"myZoomableLineChart\"\n}) {\n  const svgRef = useRef();\n  const wrapperRef = useRef();\n  const dimensions = useResizeObserver(wrapperRef);\n  const [currentZoomState, setCurrentZoomState] = useState();\n\n  //Tooltip\n  var div = d3.select(\"body\").append(\"div\")\n    .attr(\"class\", \"tooltip\")\n    .style(\"opacity\", 0);\n\n  //fixing raw stock data\n  var prices = [];\n  data[0][\"values\"].forEach((v) => {\n    prices.push({\n      datetime: Date.parse(v[\"datetime\"]),\n      value: Number(v[\"open\"])\n    });\n  });\n  prices = prices.reverse();\n\n  useEffect(() => {\n    const svg = select(svgRef.current);\n    const svgContent = svg.select(\".content\");\n    const {\n      width,\n      height\n    } =\n    dimensions || wrapperRef.current.getBoundingClientRect();\n\n    // scales + line generator\n\n    const xScale = scaleTime()\n      .domain([prices.at(0).datetime, prices.at(-1).datetime])\n      .range([0, width]);\n\n    if (currentZoomState) {\n      const newXScale = currentZoomState.rescaleX(xScale);\n      xScale.domain(newXScale.domain());\n    }\n\n    const yScale = scaleLinear()\n      .domain([0, max_price(prices)])\n      .range([height, 0]);\n\n    //Lines\n    svgContent.selectAll(\"path\").remove();\n\n    svgContent.append(\"path\")\n      .datum(prices)\n      .attr(\"fill\", \"none\")\n      .attr(\"stroke\", \"steelblue\")\n      .attr(\"stroke-width\", 1.5)\n      .attr(\"d\", line()\n        .x(function(d) {\n          return xScale(d.datetime)\n        })\n        .y(function(d) {\n          return yScale(d.value)\n        })\n      );\n\n    //Hover info\n    svg\n      .on(\"mousemove\", function(event) {\n\n        let bbox = svg.node().getBoundingClientRect();\n        let x = event.clientX - bbox.left;\n        let y = event.clientY - bbox.top;\n\n        let price = prices.find(e => e.datetime == xScale.invert(x));\n\n        let closest_date_dist = 1E8;\n        let closest_price = new Date();\n\n        let dist;\n\n        prices.forEach((e) => {\n          dist = Math.abs(e.datetime - Number(xScale.invert(x)));\n          if (dist < closest_date_dist) {\n            closest_date_dist = dist;\n            closest_price = e;\n          }\n        });\n\n        if (closest_price === undefined) return;\n\n        svgContent.selectAll(\"circle\").remove();\n        svgContent.selectAll(\"line\").remove();\n\n        let date = new Date(closest_price.datetime);\n\n        svgContent.append(\"circle\")\n\n          .attr(\"r\", 4.5)\n          .attr(\"cx\", function(d) {\n\n            return xScale(date);\n          })\n          .attr(\"cy\", function(d) {\n            return yScale(closest_price.value);\n          });\n\n        svgContent.append(\"line\")\n          .style(\"stroke\", \"steelblue\")\n          .style(\"stroke-dasharray\", \"3,3\")\n          .style(\"opacity\", 1)\n          .attr(\"x1\", function(d) {\n            return xScale(date);\n          })\n          .attr(\"y1\", function(d) {\n            return yScale(yScale.domain()[0]);\n          })\n          .attr(\"x2\", function(d) {\n            return xScale(date);\n          })\n          .attr(\"y2\", function(d) {\n            return yScale(yScale.domain()[1]);\n          });\n\n        div.transition()\n          .duration(200)\n          .style(\"opacity\", .9);\n        div.html(date.toLocaleDateString() + \"<br/>$\" + closest_price.value)\n          .style(\"left\", xScale(date) + \"px\")\n          .style(\"top\", yScale(closest_price.value) + \"px\");\n\n      });\n\n    //svgContent.datum(prices).attr(\"d\", line().x(function(d) { console.log(d.datetime); return xScale(d.datetime) }));\n\n    //   svgContent.selectAll(\"path\")\n    // .on(\"mouseover\", function(d) {\n    //       div.transition()\n    //          .duration(200)\n    //          .style(\"opacity\", .9);\n    //       div.html(formatCount(d.total_km) + \" km\" + \"<br/>\" + formatTime(d.date))\n    //          .style(\"left\", (d3.event.pageX - 20) + \"px\")\n    // \t\t     .style(\"top\", (d3.event.pageY + 6) + \"px\");\n    //       //selects the horizontal dashed line in the group\n    //       d3.select(this.nextElementSibling).transition()\n    //           .duration(200)\n    //           .style(\"opacity\", .9);\n    //       //selects the vertical dashed line in the group\n    //       d3.select(this.nextElementSibling.nextElementSibling).transition()\n    //           .duration(200)\n    //           .style(\"opacity\", .9);\n    //       })\n\n    // axes\n    const xAxis = axisBottom(xScale);\n    svg\n      .select(\".x-axis\")\n      .attr(\"transform\", `translate(0, ${height})`)\n      .call(xAxis);\n\n    const yAxis = axisLeft(yScale);\n    svg.select(\".y-axis\").call(yAxis);\n\n    // zoom\n    const zoomBehavior = zoom()\n      .scaleExtent([1, 500])\n      .translateExtent([\n        [0, 0],\n        [width, height],\n      ])\n      .on(\"zoom\", (event) => {\n        const zoomState = event.transform;\n        setCurrentZoomState(zoomState);\n      });\n\n    svg.call(zoomBehavior);\n\n  }, [currentZoomState, data, dimensions]);\n\n  return ( <\n    React.Fragment >\n    <\n    h1 > APPL < /h1> <\n    div ref = {\n      wrapperRef\n    }\n    style = {\n      {\n        marginBottom: \"2rem\"\n      }\n    } >\n    <\n    svg ref = {\n      svgRef\n    } >\n    <\n    defs >\n    <\n    clipPath id = {\n      id\n    } >\n    <\n    rect x = \"0\"\n    y = \"0\"\n    width = \"100%\"\n    height = \"100%\" / >\n    <\n    /clipPath> < /\n    defs > <\n    g className = \"content\"\n    clipPath = {\n      `url(#${id})`\n    } > < /g> <\n    g className = \"x-axis\" / >\n    <\n    g className = \"y-axis\" / >\n    <\n    /svg> < /\n    div > <\n    /React.Fragment>\n\n  );\n}\n\nexport default ZoomableLineChart;"]},"metadata":{},"sourceType":"module"}